<div class="card shadow-sm p-4 rounded-xl bg-white">
  <p-toast position="top-center" class="custom-toast"></p-toast>
  <p-confirmDialog header="ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚" icon="pi pi-exclamation-triangle"></p-confirmDialog>

  <div class="flex justify-between items-center mb-4">
    <h2 class="text-xl font-semibold text-gray-700">Cash Register Management</h2>

    <div class="flex gap-2">
      <input type="text" pInputText placeholder="Search by box name or location" [(ngModel)]="searchTerm"
        (input)="filterBoxes()" class="w-64" />
      <button pButton label="Add New Register" icon="pi pi-plus" class="p-button-success"
        (click)="openAddDialog()"></button>
    </div>
  </div>

  <p-table #dt [value]="filteredBoxes" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10, 20, 50]"
    [responsiveLayout]="'scroll'" dataKey="id" [showGridlines]="true" class="p-datatable-sm rounded-md">
    <ng-template pTemplate="header">
      <tr>
        <th>Location</th>
        <th>Register Name</th>
        <th>Opened By</th>
        <th>Open Date</th>
        <th>Close Date</th>
        <th>Status</th>
        <th class="text-center">Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-box>
      <tr>
        <td>{{ box.location }}</td>
        <td>{{ box.name }}</td>
        <td>{{ box.openedBy }}</td>
        <td>{{ box.openDate | date: 'yyyy-MM-dd' }}</td>
        <td>{{ box.closeDate ? (box.closeDate | date: 'yyyy-MM-dd') : '-' }}</td>
        <td>
          <span class="px-2 py-1 rounded-lg text-white text-sm" [ngClass]="{
              'bg-green-500': box.status === 'Open',
              'bg-blue-500': box.status === 'Balanced',
              'bg-red-500': box.status === 'Closed'
            }">
            {{ box.status }}
          </span>
        </td>
        <td class="text-center">
          <button pButton icon="pi pi-eye" class="p-button p-button-info p-button-sm mr-2" tooltip="View Details"
            (click)="viewBox(box)" pTooltip=" Box Details"></button>

          <button pButton icon="pi pi-times" class="p-button p-button-danger p-button-sm" tooltip="Close Register"
            (click)="closeBox(box)" pTooltip="close Box" [disabled]="box.status !== 'Open'"></button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- ðŸ§¾ Add New Register Dialog -->
<p-dialog header="Add New Register" [(visible)]="addDialogVisible" [modal]="true" [closable]="true" [draggable]="false"
  [resizable]="false" [style]="{ width: '450px' }">
  <div class="p-fluid space-y-4">
    <div class="field">
      <label class="font-semibold mb-2 block">Register Name</label>
      <input type="text" pInputText placeholder="Enter register name" [(ngModel)]="newBox.name" class="w-full" />
    </div>

    <div class="field">
      <label class="font-semibold mb-2 block">Location</label>
      <input type="text" pInputText placeholder="e.g., Jeddah Branch" [(ngModel)]="newBox.location" class="w-full" />
    </div>

    <div class="flex justify-end gap-2 pt-4 border-t">
      <button pButton label="Cancel" icon="pi pi-times" class="p-button-text text-gray-600 hover:text-red-500"
        (click)="addDialogVisible = false"></button>
      <button pButton label="Save" icon="pi pi-check" class="p-button-success" (click)="saveNewBox()"></button>
    </div>
  </div>
</p-dialog>