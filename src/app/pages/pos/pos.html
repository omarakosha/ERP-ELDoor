<div class="card p-5">

  <!-- 🔍 شريط البحث و زر الإضافة -->
  <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
    <div class="flex items-center w-full md:w-1/2 rounded-xl px-4 py-2 border border-gray-200">
      <i class="pi pi-search text-gray-400 mr-2"></i>
      <input
        type="text"
        pInputText
        placeholder="ابحث بإسم الموقع أو اسم صندوق البيع..."
        class="w-full outline-none border-0"
        [(ngModel)]="searchQuery"
        (input)="filterPosList()"
      />
    </div>

    <button
      pButton
      label="إضافة صندوق جديد"
      icon="pi pi-plus"
      class="p-button-success p-3 rounded-xl shadow-md"
      (click)="openAddDialog()"
    ></button>
  </div>

<!-- 🏪 قائمة المواقع -->
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
  <div
    *ngFor="let pos of filteredPosList"
    class="rounded-2xl shadow-lg border border-gray-200 hover:shadow-xl transition-all duration-200"
  >
    <div class="p-5 flex flex-col h-full">
      <div class="flex justify-between items-center mb-3">
        <h3 class="text-lg font-bold text-gray-800">{{ pos.name }}</h3>
        <span
          class="text-xs px-3 py-1 rounded-full"
          [ngClass]="{
            'bg-green-100 text-green-600': pos.status === 'open',
            'bg-gray-200 text-gray-600': pos.status === 'closed'
          }"
        >
          {{ pos.status === 'open' ? 'مفتوح' : 'مغلق' }}
        </span>
      </div>

      <p class="text-sm text-gray-500 mb-1"><strong>الموقع:</strong> {{ pos.location }}</p>
      <p class="text-sm text-gray-500 mb-1"><strong>تم الفتح في:</strong> {{ pos.openedAt }}</p>
      <p class="text-sm text-gray-500 mb-1"><strong>المستخدم:</strong> {{ pos.user }}</p>
      <p class="text-sm text-gray-500 mb-3"><strong>طرق الدفع:</strong> {{ pos.paymentMethods }}</p>

      <!-- أزرار المتابعة والإغلاق -->
      <div class="flex flex-col mt-auto">
        <div class="flex justify-between">
          <button
            pButton
            label="متابعة البيع"
            icon="pi pi-shopping-cart"
            class="p-button-primary p-button-rounded px-4"
            (click)="continueSale(pos)"
          ></button>

          <button
            pButton
            label="إغلاق الصندوق"
            icon="pi pi-lock"
            class="p-button-danger p-button-rounded px-4"
            (click)="attemptClosePos(pos)"
          ></button>
        </div>

        <!-- حاوية ثابتة للرسالة للتحكم في ارتفاع البطاقة -->
        <div class="mt-2 min-h-[20px]">
          <p
            [class.invisible]="!pos.showCloseWarning"
            class="text-xs text-red-500 text-center w-full"
          >
            ⚠ لا يمكن الإغلاق — الصندوق مفتوح على جهاز آخر.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- 🧾 نافذة إضافة صندوق بيع جديد -->
  <p-dialog
    header="إضافة صندوق بيع جديد"
    [(visible)]="addDialogVisible"
    [modal]="true"
    [closable]="true"
    [draggable]="false"
    [resizable]="false"
    [style]="{ width: '450px' }"
  >
    <div class="p-fluid space-y-4">
      <div class="field">
        <label class="font-semibold mb-2 block">اسم الصندوق</label>
        <input
          type="text"
          pInputText
          placeholder="أدخل اسم الصندوق"
          [(ngModel)]="newPos.name"
          class="w-full"
        />
      </div>

      <div class="field">
        <label class="font-semibold mb-2 block">الموقع</label>
        <input
          type="text"
          pInputText
          placeholder="مثلاً: فرع الرياض"
          [(ngModel)]="newPos.location"
          class="w-full"
        />
      </div>

      <div class="field">
        <label class="font-semibold mb-2 block">طرق الدفع</label>
        <input
          type="text"
          pInputText
          placeholder="مثلاً: نقدي، مدى، تحويل"
          [(ngModel)]="newPos.paymentMethods"
          class="w-full"
        />
      </div>

      <div class="flex justify-end gap-2 pt-4 border-t">
        <button
          pButton
          label="إلغاء"
          icon="pi pi-times"
          class="p-button-text text-gray-600 hover:text-red-500"
          (click)="addDialogVisible = false"
        ></button>
        <button
          pButton
          label="حفظ"
          icon="pi pi-check"
          class="p-button-success"
          (click)="saveNewPos()"
        ></button>
      </div>
    </div>
  </p-dialog>

</div>
